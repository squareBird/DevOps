name: Docker

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

on:
  push:
    branches: [ master ]
    # Publish semver tags as releases.
    tags: [ 'v*.*.*' ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: self-hosted
    steps:

      - name: Checkout
        uses: actions/checkout@v2

      - name: Docker Login
        run: docker login ${{ secrets.HARBOR_ADDRESS }} -u ${{ secrets.HARBOR_USERNAME }} -p ${{ secrets.HARBOR_PASSWORD }}

        # image μ„Έν…
      - name: Docker meta
        run: docker tag mariadb ${{ secrets.HARBOR_ADDRESS}}${{ secrets.HARBOR_REPOSITORY}}mymariadb:0.5

        # Harbor Push
      - name: Push Harbor
        run: docker push ${{ secrets.HARBOR_ADDRESS}}${{ secrets.HARBOR_REPOSITORY}}mymariadb:0.5
#         uses : docker/build-push-action@v2
#         with:
#           context: .
#           file: ./Dockerfile
#           platforms: linux/amd64
#           push: true
#
